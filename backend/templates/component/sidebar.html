{%load static%}
{%load custom_filters%}

<nav class="navbar-default navbar-static-side" role="navigation">
    <div class="sidebar-collapse">
      <ul class="nav metismenu" id="side-menu">
        <li class="nav-header">
          <div class="dropdown profile-element">
            {% if user.is_authenticated %}
            <span>
            {% if user.account.image %}
              <img alt="image" class="img-circle img-user" src="{{ user.account.image.url }}" />
            {% else %}
                <!-- Replace 'path/to/default/image.jpg' with the actual path to your default image -->
                <img alt="default image" class="img-circle img-user" src="{% static 'assets/img/no-img.jpg' %}" />
            {% endif %}
            </span>
            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
              <span class="clear">
                <span class="block m-t-xs">
                  <strong class="font-bold">{{ user.get_full_name }}</strong>
                </span>
                <span class="text-muted text-xs block"
                  >{{ user.account.department_works_at.department_name }} <b class="caret"></b
                ></span>
              </span>
            </a>
            {% endif %}
            {%if user.is_authenticated%}
            <ul class="dropdown-menu animated fadeInRight m-t-xs">
              <li>
                <!-- Assuming 'user' is a variable containing a User object with an 'id' attribute -->
                <a href="{% url 'profile' user.id|base64_encode:10 %}">Profile</a>
            </li>
              <li><a href="contacts.html">Contacts</a></li>
              <li><a href="mailbox.html">Mailbox</a></li>
              <li class="divider"></li>
              
              <li>
                <a href="{%url 'logout'%}"> Log out </a>
              </li>
              {%else%}
              <li>
                <a href="{%url 'login'%}"></i> Log in </a>
              </li>
              {%endif%}
            </ul>
          </div>
        </li>
        
        <div class="logo-user  m-t-xs text-center">
          {% if user.is_authenticated %}
            {% if user.account.image %}
            <a href="{% url 'profile' user.id|base64_encode:10 %}" ><img alt="image" class="img-circle img-user" src="{{ user.account.image.url }}" />
            </a>
              
            {% else %}
               <a href="{% url 'profile' user.id|base64_encode:10 %}">
                <img alt="default image" class="img-circle img-user" src="{% static 'assets/img/no-img.jpg' %}" />
               </a>
            {% endif %}
            {%endif%} 
        </div>
     
        {% for menu_item in MENU_CONFIG %}
              <li class="{% if request.path == menu_item.url or request.path|slice:":-1"|default:'' == menu_item.url|slice:":-1"|default:'' %}active{% endif %}">
                  <a href="{{ menu_item.url }}">
                      <i class="{{ menu_item.icon }}"></i>
                      <span class="nav-label">{{ menu_item.title }}</span>
                      {% if menu_item.submenu %}
                          <span class="fa arrow"></span>
                      {% endif %}
                  </a>
                  {% if menu_item.submenu %}
                      <ul class="nav nav-second-level">
                          {% for submenu_item in menu_item.submenu %}
                              <li class="{% if request.path|slice:":-1"|default:'' == submenu_item.url|slice:":-1"|default:'' %}active{% endif %}">
                                  <a href="{{ submenu_item.url }}">{{ submenu_item.title }}</a>
                              </li>
                          {% endfor %}
                      </ul>
                  {% endif %}
              </li>
          {% endfor %}

      </ul>
    </div>
  </nav>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
        var currentPath = window.location.pathname;

        var menuItems = document.querySelectorAll('.nav a');
        menuItems.forEach(function(item) {
            var menuItemUrl = item.getAttribute('href');
            if (currentPath === menuItemUrl || currentPath.startsWith(menuItemUrl)) {
                item.closest('li').classList.add('active');
            }
        });
    });

    var links = document.querySelectorAll('.logo-element a');

// Lặp qua từng thẻ <a>
links.forEach(function(link) {
    // Ngăn chặn sự kiện mặc định của thẻ <a>
    link.addEventListener('click', function(event) {
        // Ngăn chặn hành động mặc định của thẻ <a> (chẳng hạn mở URL)
        event.preventDefault();
        // Ngăn chặn sự kiện từ việc lan truyền lên các phần tử cha
        event.stopPropagation();
    });
});
</script>

         {% comment %} <li class="">
          <a href="index.html"
            ><i class="fa fa-th-large"></i>
            <span class="nav-label">QL Nhóm Thành Viên</span>
            <span class="fa arrow"></span
          ></a>
          <ul class="nav nav-second-level">
            <li class="active"><a href="{% url 'user' %}">QL Thành Viên</a></li>
            <li><a href="{% url 'user_category' %}">QL Loại Thành Viên</a></li>
            <li><a href="{% url 'department' %}">QL Phòng Ban </a></li>
            <li><a href="{% url 'position' %}">QL Chức Vụ</a></li>
          </ul>
        </li>
        <li class="active">
          <a href="index.html"
            ><i class="fa fa-bell"></i>
            <span class="nav-label">QL Thông báo</span>
            <span class="fa arrow"></span
          ></a>
          <ul class="nav nav-second-level">
            <li class="active"><a href="{% url 'list_noti' %}">QL Thông Báo</a></li>
            <li><a href="{% url 'readrecord' %}">QL Lượt Xem</a></li>
          </ul>
        </li>  {% endcomment %}