{% extends 'base.html' %} {% load static %} {% block main-content%}
{% if success_message %}
    <script>
        // Hiển thị toast khi có thông báo thành công
        showSuccessToast('{{ success_message }}');
    </script>
{% endif %}
<div class="wrapper wrapper-content">

  <div class="row">
    <div class="col-lg-4">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Thông báo</h5>
          <div class="ibox-tools">
            <a class="collapse-link">
              <i class="fa fa-chevron-up"></i>
            </a>
            <a class="close-link">
              <i class="fa fa-times"></i>
            </a>
          </div>
        </div>
        <div class="ibox-content ibox-heading">
          <h3><i class="fa fa-bell"></i> <strong>Thông báo mới</strong></h3>
          {% if unread_notification_count > 0 %}
            <small><i class="fa fa-tim"></i> Bạn có {{ unread_notification_count }} thông báo mới chưa đọc.</small>
          {% else %}
            <small><i class="fa fa-tim"></i> Bạn đã đọc hết thông báo.</small>
          {% endif %}
        </div>
        <div class="ibox-content">
          <div class="feed-activity-list">
            {% for notification in notifications|slice:":7" %}
                <div class="feed-element">
                    <div>
                        {% load tz %}
                        {% with time_difference=notification.created_date|timesince:now %}
                            <small class="pull-right text-navy">{{ time_difference|default:"just now" }}</small>
                        {% endwith %}
                        <strong>{{ notification.sender.get_full_name }}</strong>
                        <div>
                          <a class="link-message" href="{% url 'notification' notification_url=notification.url %}">{{ notification.title }}</a>
                            
                        </div>
                        <small class="text-muted">{{ notification.created_date }}</small>
                    </div>
                </div>
            {% endfor %}
        </div>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="row">
        <div class="col-lg-12">
          <div class="ibox float-e-margins">
            <div class="ibox-title">
              <h5>Công việc được giao</h5>
              <div class="ibox-tools">
                <a class="collapse-link">
                  <i class="fa fa-chevron-up"></i>
                </a>
                <a class="close-link">
                  <i class="fa fa-times"></i>
                </a>
              </div>
            </div>
            <div class="ibox-content ibox-heading">
              <h3><i class="fa fa-tasks"></i> <strong>Công việc</strong></h3>
              {% if tasks_with_unconfirm_count > 0 %}
                    <small><i class="fa fa-tim"></i> Bạn có {{ tasks_with_unconfirm_count }} công việc chưa xác nhận.</small>
                {% else %}
                    <small><i class="fa fa-tim"></i> Bạn đã xác nhận hết công việc được giao.</small>
                {% endif %}
            </div>
            <div class="ibox-content">
              <div class="feed-activity-list">
                {% for task in tasks|slice:":7" %}
                    <div class="feed-element">
                        <div>
                            {% load tz %}
                            {% with time_difference=task.created_date|timesince:now %}
                                <small class="pull-right text-navy">{{ time_difference|default:"just now" }}</small>
                            {% endwith %}
                            <strong>{{ task.creator }}</strong>
                            <div class="uk-flex uk-flex-middle uk-flex-space-between">
                              <a class="link-message" href="{% url 'task_detail' task_url=task.url %}">{{ task.title }}</a>
                              {% if user not in task.confirmed_users.all %}
                                    <a href="{% url 'confirm_task_participation' task_id=task.id %}" class="btn-danger btn-rounded btn-sm b-r-xl">Xác nhận công việc</a>
                                {% else %}
                                    <span class="btn-success btn-rounded btn-sm b-r-xl">Đã xác nhận</span> 
                                {% endif %}  
                            </div>
                            <small class="text-muted">{{ task.created_date }}</small>
                        </div>
                    </div>
                {% endfor %}
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock main-content%}
